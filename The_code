# ------------------------- 

# 6. User Input Loop Fixed 

# ------------------------- 

from IPython.display import display 

from datetime import datetime, timedelta 

 

while True: 

    answer = input("Do you want to enter a new patient? (yes/no): ").lower().strip() 

 

    if answer == "no": 

        print("Program finished.") 

        break 

    elif answer != "yes": 

        print("Please enter yes or no.") 

        continue 

 

    print("\n=========== New Patient ===========") 

 

    # Name validation 

    while True: 

        name = input("Enter Patient Name: ") 

        if name.replace(" ", "").isalpha(): 

            break 

        else: 

            print("Name must contain letters only.") 

 

    # Age validation 

    while True: 

        age_input = input("Enter Patient Age: ") 

        if age_input.isdigit(): 

            age = int(age_input) 

            break 

        else: 

            print("Age must contain numbers only.") 

 

    # Show diseases 

    print("\nAvailable Diseases:") 

    for d in diseases: 

        print("-", d) 

 

    # Disease input validation 

    disease = input("Enter disease exactly as shown: ") 

    while disease not in diseases: 

        print("Invalid disease.") 

        disease = input("Enter disease again: ") 

 

    severity = df[df["Disease"] == disease]["Disease_Severity"].iloc[0] 

 

    # Prepare data for prediction 

    new_patient = pd.DataFrame( 

        [[age, disease, severity]], 

        columns=["Age", "Disease", "Disease_Severity"] 

    ) 

    new_patient_encoded = ct.transform(new_patient) 

    predicted_priority = model.predict(new_patient_encoded)[0] 

 

    # Schedule appointment 2 hours after last or now 

    if appointments.empty: 

        appointment_time = datetime.now() 

    else: 

        last_time = datetime.strptime( 

            appointments.iloc[-1]["Appointment_Time"], 

            "%Y-%m-%d %H:%M" 

        ) 

        appointment_time = last_time + timedelta(hours=2) 

 

    appointment_time_str = appointment_time.strftime("%Y-%m-%d %H:%M") 

 

    # Add record 

    new_record = { 

        "Patient_Name": name, 

        "Age": age, 

        "Disease": disease, 

        "Predicted_Priority": predicted_priority, 

        "Appointment_Time": appointment_time_str 

    } 

    appointments = pd.concat( 

        [appointments, pd.DataFrame([new_record])], 

        ignore_index=True 

    ) 

 

    # Display nicely as table 

    print("\nAppointment Scheduled Successfully!") 

    print("Predicted Priority:", predicted_priority) 

    print("Appointment Time:", appointment_time_str) 

    print("\nCurrent Appointments Table:") 

    display(appointments) 
